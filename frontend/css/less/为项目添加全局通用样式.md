
前提：安装 less 与 less-loader 插件

配置前，请查阅框架文档确认是否有预处理选项

## 有预处理选项的框架

### 在vite中可以通过配置 preprocessorOptions

[链接](https://cn.vite.dev/config/shared-options.html#css-preprocessoroptions-extension-additionaldata)

语法：css.preprocessorOptions[extension].additionalData

该选项可以用来为每一段样式内容添加额外的代码


// `less-loader`4版本及以上是使用`additionalData`，而非旧版的`modifyVars`

```js
    // vite.config.js
    css: {
        preprocessorOptions: {
            less: {
                //  公共的单个设置
                // globalVars: {
                //     blue: "#1CC0FF",
                // },
                javascriptEnabled: true, // 允许使用js表达式
                // 在入口 Less 文件前注入你的变量文件或代码
                additionalData: `@import "@/assets/styles/common.less";`, // 有./src路径转写
                // additionalData: `@import "${path.resolve(__dirname, 'src/assets/styles/common.less')}";`,  // 有无./src路径转写都生效
            },
        },
    },
```

less 4.0 以下版本配置
```js
    // vite.config.js
    css: {
        preprocessorOptions: {
            less: {
                javascriptEnabled: true, // 允许使用js表达式
                // modifyVars 用于覆盖或注入 Less 变量
                modifyVars: {
                    'primary-color': '#1DA57A',
                    // hack 编译器特殊指令 允许在编译过程中注入任意 Less 代码
                    // true; 是占位符，后面是导入语句
                    hack: `true; @import "${path.resolve(__dirname, 'src/assets/styles/common.less')}";`,
                },,
            },
        },
    },
```

注意：`@import "${path.resolve(__dirname, 'src/assets/css/global.less')}";`中的`""`和结尾处的`;`不能省略，否则会报错：`# missing semi-colon or unrecognised media features on import`

可以认为是在为每个 less 文件预先引入了 
<code>
@import url(@/assets/styles/common.less);
</code>

### 在 vue-cli 项目中

(链接)(https://cli.vuejs.org/zh/config/#css-loaderoptions)

通过 less-loader 暴露的 api {lessOptions、 additionalData}进行配置

```js
// vue.config.js 
module.exports = {
    css: {
		loaderOptions: {
			less: {
				lessOptions: {
					// 启用 LESS 中的 JavaScript 表达式支持。
					javascriptEnabled: true
				},
				additionalData: `@import url("@/assets/styles/common.less");`
			}
		}
	}
}
```

## 在一些没有预装处理项的框架中进行配置

###  umimax 项目中

需要在配置文件中通过 webpack 链式配置（基于 webpack-chain 插件）配置

```ts
export default (memo, { env }) => {
  console.log('打包环境：', env);

  // 为less文件注入公用less文件
  // lessLoader2 是自定义的规则名，test匹配less结尾的后缀文件
  // 使用 less 解析，再使用less-loader扩展
  memo.module
    .rule('lessLoader2')
    .test(/\.less$/)
    .use('less')
    .loader('less-loader')
    .options({
      additionalData: `@import "@/global.less";`,
    });
};
```

